<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Admin - Cloud AI</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<!-- Tesseract JS -->
<script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
<!-- TradingView Widget -->
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

<style>
  /* --- CORE UI --- */
  * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
  body { margin: 0; background-color: #000; font-family: 'Courier New', monospace; color: #fff; overflow: hidden; }

#matrix {
  position: absolute;
  inset: 0;
  z-index: 1;
}

#loginPage {
  position: relative;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;
}

.login-box {
  position: relative;
  width: 410px;
  padding: 64px;
  border: 2px solid #0f0;
  overflow: hidden;
}

.login-box iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: none;
  z-index: 0;
}

.login-box .content {
  position: relative;
  z-index: 1;
  text-align: center;
  color: #0f0;
}

#pass {
  padding: 10px;
  width: 200px;
  background: none;
  border: 1px solid #0f0;
  color: #0f0;
  margin-bottom: 10px;
}

.login-box button {
  padding: 10px 20px;
  background: #0f0;
  color: #000;
  border: none;
}

#mini-terminal {
  position: absolute;
  top: -65px;
  left: -40px;
  width: 320px;   
  height: auto;
  font-size: 12px;
  font-weight: bold;
  font-family: 'Courier New', monospace;
  color: #00ff00;
  text-shadow: 0 0 5px #00ff00, 0 0 10px #00ff00;
  opacity: 1;
  text-align: left;
  line-height: 1.5;
  background: none;
  padding: 10px;
  border-left: 2px solid #0f0;
  z-index: 10;
}

  /* --- DASHBOARD --- */
  #dashboard { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100vh; z-index: 50; overflow-y: auto; background: rgba(0,0,0,0.9); }
  .container { max-width: 600px; margin: 0 auto; padding: 20px; padding-bottom: 100px; }
  .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 25px; background: rgba(0,0,0,0.5); }
  .logout-btn { background: #000; border: 2px solid red; color: red; padding: 5px 15px; font-weight: bold; cursor: pointer; }

  /* --- STATUS & GRID --- */
  .status-row { display: flex; gap: 15px; margin-bottom: 25px; }
  .card { flex: 1; border: 2px solid #333; padding: 20px; background: rgba(15,15,15,0.95); text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 130px; }
  .card small { color: #aaa; letter-spacing: 1px; font-size: 11px; margin-bottom: 10px; display: block; font-weight: bold; }
  
  .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
  .action-card { background: rgba(15,15,15,0.95); border: 2px solid #333; padding: 20px; text-align: center; cursor: pointer; min-height: 120px; display: flex; flex-direction: column; justify-content: center; transition: 0.2s; }
  .action-card:hover { border-color: #0f0; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,255,0,0.1); }
  .scan-card { grid-column: span 2; border-color: #00ffff; color: #00ffff; background: rgba(0, 255, 255, 0.05); }
  .school-card { grid-column: span 2; border-color: #e040fb; color: #e040fb; background: rgba(224, 64, 251, 0.05); }
  .ai-core-card { border-color: #ff9800; color: #ff9800; background: rgba(255, 152, 0, 0.05); }

  /* --- PAGES & FORMS --- */
  .slide-page { position: fixed; inset: 0; left: 100%; background: #000; z-index: 200; transition: 0.3s; overflow-y: auto; display: flex; flex-direction: column; }
  .slide-page.active { left: 0; }
  .page-head { padding: 20px; background: #111; border-bottom: 2px solid #333; display: flex; align-items: center; justify-content: space-between; }
  .back-btn { background: none; border: none; color: #fff; font-size: 28px; cursor: pointer; margin-right: 10px; }
  
  .form-group { padding: 20px; }
  label { display: block; margin-top: 15px; color: #aaa; font-size: 12px; font-weight: bold; }
  input[type=text], textarea, input[type=file], select, input[type=password] { width: 100%; padding: 15px; background: #151515; border: 1px solid #444; color: #fff; margin-top: 5px; box-sizing: border-box; font-family: monospace; }
  input:focus, textarea:focus, select:focus { border-color: #0f0; }
  .save-btn { width: 100%; padding: 15px; background: #0f0; color: #000; font-weight: bold; border: none; margin-top: 25px; cursor: pointer; font-size: 16px; }
  .school-btn { width: 100%; padding: 15px; background: #e040fb; color: #000; font-weight: bold; border: none; margin-top: 25px; cursor: pointer; font-size: 16px; }
  .tBtn { flex:1; padding:15px; background:#111; border: 2px solid #333; color:#fff; cursor: pointer; font-weight: bold; }

  /* --- SCANNER SPECIFIC (RESTORED) --- */
  .scanner-overlay-controls { padding: 15px; background: #111; display: flex; gap: 10px; border-bottom: 2px solid #333; }
  .pair-control { flex: 2; padding: 10px; background: #000; border: 2px solid #00ffff; color: #fff; font-weight: bold; }
  .learn-btn { flex: 1; padding: 10px; background: #222; color: #aaa; border: 2px solid #444; font-weight: bold; cursor: pointer; font-size: 10px; }
  .learn-btn.active { background: #e040fb; color: #fff; border-color: #e040fb; }
  #tvContainer { flex: 1; position: relative; width: 100%; height: 60vh; }
  #aiBrainCanvas { position: absolute; top: 0; left: 0; opacity: 0; pointer-events: none; z-index: -1; }
  .ai-footer { padding: 20px; background: #111; border-top: 2px solid #333; }
  .match-track { width: 100%; height: 6px; background: #222; margin: 15px 0; border-radius: 2px; }
  #matchBar { width: 0%; height: 100%; background: #00ffff; transition: 0.3s; }

  /* --- SWITCH --- */
  .switch { position: relative; display: inline-block; width: 50px; height: 24px; float:right; }
  .switch input { opacity: 0; width: 0; height: 0; }
  .slider { position: absolute; cursor: pointer; inset: 0; background-color: #222; transition: .2s; border: 2px solid #555; }
  .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: #888; transition: .2s; }
  input:checked + .slider { background-color: #0f0; border-color: #0f0; }
  input:checked + .slider:before { transform: translateX(26px); background-color: #000; }

  /* --- MEMORY TABS & LIST --- */
  .memory-tabs { display: flex; background: #111; border-bottom: 2px solid #333; }
  .mem-tab { flex: 1; padding: 15px 5px; text-align: center; cursor: pointer; font-size: 11px; font-weight: bold; color: #555; transition: 0.3s; }
  .mem-tab.active { background: #1a1a1a; color: #fff; border-bottom: 2px solid #fff; }
  .mem-tab.school.active { border-bottom-color: #e040fb; color: #e040fb; }
  .mem-tab.manual.active { border-bottom-color: #00ffff; color: #00ffff; }
  .mem-tab.auto.active { border-bottom-color: #ff9800; color: #ff9800; }
  .count-badge { font-size: 10px; margin-left: 2px; opacity: 0.7; }

  .list-item { background: #0a0a0a; padding: 10px; margin-bottom: 10px; border-bottom: 1px solid #333; display: flex; align-items: flex-start; }
  .list-img { width: 70px; height: 70px; object-fit: cover; margin-right: 15px; border-radius: 4px; border: 1px solid #333; flex-shrink: 0; }
  .list-content { flex: 1; overflow: hidden; }
  .list-title { font-size: 14px; font-weight: bold; margin-bottom: 4px; display: block; }
  .list-desc { font-size: 11px; color: #888; cursor: pointer; line-height: 1.4; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .list-desc.expanded { white-space: normal; color: #ccc; background: #111; padding: 5px; border-radius: 4px; margin-top: 5px; }
  .list-badge { font-size: 10px; padding: 2px 6px; border-radius: 2px; background: #222; margin-top: 5px; display: inline-block; font-weight: bold; }
  .del-btn { color: #f44336; background: none; border: none; font-size: 20px; padding: 10px; cursor: pointer; margin-left: 5px; }
  
  /* --- CUSTOM POPUP CSS --- */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(2px);
}

.modal-box {
  background: #000;
  border: 2px solid #0f0;
  width: 320px;
  padding: 30px;
  text-align: center;
  box-shadow: 0 0 30px rgba(0, 255, 0, 0.2);
  animation: popIn 0.3s ease;
}

.modal-box h2 {
  margin: 0 0 15px 0;
  color: #0f0;
  font-family: 'Courier New', monospace;
  text-transform: uppercase;
  border-bottom: 1px dashed #333;
  padding-bottom: 10px;
}

.modal-msg {
  color: #fff;
  font-size: 14px;
  margin-bottom: 25px;
  line-height: 1.5;
}

.modal-box button {
  background: #0f0;
  color: #000;
  border: none;
  padding: 12px 25px;
  font-weight: bold;
  cursor: pointer;
  font-family: monospace;
  width: 100%;
  transition: 0.2s;
}

.modal-box button:hover {
  background: #fff;
  box-shadow: 0 0 15px #0f0;
}

@keyframes popIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

</style>
</head>
<body>

<!-- MATRIX BACKGROUND -->
<canvas id="matrix"></canvas>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="login-box">
    <iframe src="https://123lider.github.io/Chitchat3/"></iframe>

    <div class="content">
      <div id="mini-terminal"></div>

      <h2 style="color:#0f0; font-family:'Courier New', sans-serif; margin-bottom:20px;">
        ADMIN
      </h2>

      <input type="password" id="pass" placeholder="ENTER CODE">
      <br>
      <button onclick="login()">LOGIN</button>
    </div>
  </div>
</div>


<!-- DASHBOARD -->
<div id="dashboard">
    <div class="container">
        <div class="header"><h3 style="margin:0; color:#0f0;">AI CONTROL</h3><button class="logout-btn" onclick="location.reload()">EXIT</button></div>
        
        <div class="status-row">
            <div class="card" style="border-color:#0f0;">
                <small>BOT STATUS</small>
                <b id="statusTxt" style="font-size:16px; margin-bottom:12px; color:#555;">OFFLINE</b>
                <label class="switch" style="float:none;"><input type="checkbox" id="botToggle"><span class="slider"></span></label>
            </div>
            <div class="card"><small>ACTIVE USERS</small><b id="userCount" style="font-size:36px; color:#fff;">0</b></div>
        </div>

        <div class="btn-grid">
            <div class="action-card scan-card" onclick="openPage('scannerPage')"><h1 style="margin:0;">[ AUTO ]</h1><h3>MARKET SCANNER</h3><small>AI Analysis & Auto Learning</small></div>
            <div class="action-card school-card" onclick="openPage('schoolPage')"><h2 style="margin:0;">[ SCHOOL ]</h2><h3>BASIC COURSE</h3><small>Teach Anatomy & Logic</small></div>
            <div class="action-card ai-core-card" onclick="openPage('aiSetupPage')"><h2 style="margin:0;">[ AI ]</h2><h3>AI CONFIG</h3><small>DeepSeek / GPT / Gemini</small></div>
            <div class="action-card" onclick="openPage('trainPage')"><h3>+ MANUAL</h3><small>Add Pattern</small></div>
            <div class="action-card" onclick="openPage('listPage')"><h3>MEMORY</h3><small>View Cloud Data</small></div>
            <div class="action-card" onclick="openPage('setPage')"><h3>SETTINGS</h3><small>Password & Config</small></div>
        </div>
    </div>
</div>

<!-- SCANNER PAGE (RESTORED FULLY) -->
<div id="scannerPage" class="slide-page">
    <div class="scanner-overlay-controls">
        <select id="activePair" class="pair-control" onchange="updatePair()">
            <option value="FX:EURUSD">EUR/USD (REAL)</option>
            <option value="FX:GBPUSD">GBP/USD (REAL)</option>
            <option value="FX:USDJPY">USD/JPY (REAL)</option>
            <option value="BINANCE:BTCUSDT">BITCOIN (CRYPTO)</option>
            <option value="BINANCE:ETHUSDT">ETHEREUM (CRYPTO)</option>
            <option disabled>--- OTC MARKETS ---</option>
            <option value="FX_IDC:USDBRL">USD/BRL (OTC)</option>
            <option value="FX_IDC:USDMXN">USD/MXN (OTC)</option>
            <option value="FX_IDC:USDINR">USD/INR (OTC)</option>
            <option value="FX_IDC:USDTRY">USD/TRY (OTC)</option>
        </select>
        <button id="btnLearn" class="learn-btn" onclick="toggleAutoLearn()">üß† LEARN: OFF</button>
    </div>
    
    <div id="tvContainer"><div id="tvChart"></div></div>
    <canvas id="aiBrainCanvas" width="100" height="100"></canvas>
    
    <div class="ai-footer">
        <div style="display:flex; justify-content:space-between; font-size:12px; color:#aaa;">
            <span id="marketStatus">IDLE</span>
            <span id="matchPct">0%</span>
        </div>
        <div class="match-track"><div id="matchBar"></div></div>
        
        <div style="display:flex; justify-content:space-between; margin-top:15px;">
            <div style="display:flex; gap:10px;">
                <button onclick="startAutoScan()" id="btnScan" style="background:#00ffff; color:#000; border:2px solid #00ffff; padding:8px 20px; font-weight:bold;">START</button>
                <button onclick="stopAll()" style="background:#222; color:#fff; border:2px solid #555; padding:8px 20px;">STOP</button>
            </div>
            <div style="text-align:right;">
                <small style="color:#aaa">LAST SIGNAL</small><br>
                <b id="lastSig" style="color:#fff">---</b>
            </div>
        </div>
        
        <button onclick="closePage('scannerPage'); stopAll()" style="width:100%; margin-top:20px; background:#111; color:#888; border:2px solid #333; padding:10px;">EXIT</button>
    </div>
</div>

<!-- LIST PAGE (MEMORY) -->
<div id="listPage" class="slide-page">
    <div class="page-head"><button class="back-btn" onclick="closePage('listPage')">&#8592;</button><h3>CLOUD MEMORY</h3></div>
    <div class="memory-tabs">
        <div class="mem-tab school active" onclick="switchTab('school')" id="tab-school">BASIC <span id="cnt-school" class="count-badge">(0)</span></div>
        <div class="mem-tab manual" onclick="switchTab('manual')" id="tab-manual">MANUAL <span id="cnt-manual" class="count-badge">(0)</span></div>
        <div class="mem-tab auto" onclick="switchTab('auto')" id="tab-auto">AUTO AI <span id="cnt-auto" class="count-badge">(0)</span></div>
    </div>
    <div id="patList" style="padding:10px;">Loading Cloud Data...</div>
</div>

<!-- SCHOOL PAGE -->
<div id="schoolPage" class="slide-page">
    <div class="page-head"><button class="back-btn" onclick="closePage('schoolPage')">&#8592;</button><h3 style="color:#e040fb;">AI SCHOOL</h3></div>
    <div class="form-group">
        <label>Pattern Name</label><input type="text" id="bName" placeholder="e.g. Doji">
        <label>Explanation</label><textarea id="bExpl" rows="3"></textarea>
        <label>Chart Image</label><input type="file" id="bImg" accept="image/*" onchange="analyzeAnatomy(this)">
        <div id="ocrStatus" style="display:none; color:#00ffff; margin-top:5px;">AI Reading...</div>
        <label>AI Logic (Extracted)</label><textarea id="bLogic" rows="5" placeholder="Waiting for image..."></textarea>
        <button class="school-btn" onclick="saveBasicCourse()">SAVE TO CLOUD</button>
    </div>
</div>

<!-- MANUAL TRAIN PAGE -->
<div id="trainPage" class="slide-page">
    <div class="page-head"><button class="back-btn" onclick="closePage('trainPage')">&#8592;</button><h3>ADD MANUAL</h3></div>
    <div class="form-group">
        <label>Pattern Name</label><input type="text" id="pDesc">
        <label>Explanation</label><textarea id="pExpl" rows="3"></textarea>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button onclick="setType('UP',this)" class="tBtn" style="background:#111;">UP</button>
            <button onclick="setType('DOWN',this)" class="tBtn" style="background:#111;">DOWN</button>
        </div>
        <label>Image</label><input type="file" id="pImg" accept="image/*">
        <button class="save-btn" onclick="savePattern()">SAVE TO CLOUD</button>
    </div>
</div>

<!-- AI SETUP PAGE -->
<div id="aiSetupPage" class="slide-page">
    <div class="page-head"><button class="back-btn" onclick="closePage('aiSetupPage')">&#8592;</button><h3 style="color:#ff9800;">AI BRAIN</h3></div>
    <div class="form-group">
        <div class="api-box" style="border-color:#00ffff;">
            <label style="color:#00ffff; margin:0;">DeepSeek AI</label>
            <label class="switch"><input type="checkbox" id="dsToggle"><span class="slider"></span></label>
            <input type="text" id="dsKey" placeholder="sk-..." style="margin-top:10px;">
        </div>
        <div class="api-box"><label style="margin:0;">Google Gemini</label><label class="switch"><input type="checkbox" id="gemToggle"><span class="slider"></span></label><input type="text" id="gemKey" placeholder="AIzaSy..." style="margin-top:10px;"></div>
        <div class="api-box"><label style="margin:0;">ChatGPT</label><label class="switch"><input type="checkbox" id="gptToggle"><span class="slider"></span></label><input type="text" id="gptKey" placeholder="sk-..." style="margin-top:10px;"></div>
        <div id="aiConsole" class="chat-box" style="background:#0a0a0a; border:1px solid #333; height:150px; overflow-y:auto; margin-top:20px; padding:10px; font-size:12px; font-family:monospace;"><div class="msg-ai">AI System Ready.</div></div>
        <div style="display:flex; gap:10px; margin-top:10px;"><input type="text" id="chatInput" placeholder="Test AI..." style="margin:0;"><button onclick="sendChatMessage()" style="width:30%; background:#ff9800; border:none; color:#000; font-weight:bold;">CHECK</button></div>
        <button class="save-btn" onclick="saveAIKeys()" style="border-color:#ff9800; background:#ff9800; color:#000;">SAVE CONFIG</button>
    </div>
</div>

<!-- SETTINGS -->
<div id="setPage" class="slide-page">
    <div class="page-head"><button class="back-btn" onclick="closePage('setPage')">&#8592;</button><h3>CONFIG</h3></div>
    <div class="form-group">
        <label>Change Access Password</label><input type="text" id="newPass" placeholder="Enter New Code"><button class="save-btn" onclick="updatePassword()">UPDATE CODE</button>
        <label style="margin-top:30px;">Login Box Background (Embed Link)</label><input type="text" id="bgLink" placeholder="https://youtube.com/embed/..."><button class="save-btn" onclick="saveBgLink()" style="background:#00ffff; color:#000; border-color:#00ffff;">UPDATE BG</button>
        <label style="margin-top:20px;">Offline Message</label><input type="text" id="offMsg"><button class="save-btn" onclick="saveSet()" style="background:#222; color:#fff;">UPDATE MSG</button>
    </div>
</div>
<!-- CUSTOM POPUP HTML -->
<div id="customModal" class="modal-overlay">
  <div class="modal-box">
    <h2 id="modalTitle">SYSTEM ALERT</h2>
    <div id="modalMsg" class="modal-msg">Processing...</div>
    <button onclick="closeModal()">ACKNOWLEDGE</button>
  </div>
</div>
<script>

/* MATRIX EFFECT */
const canvas = document.getElementById('matrix');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*';
const fontSize = 13;
const columns = Math.floor(canvas.width / fontSize);
const drops = Array(columns).fill(1);

setInterval(() => {
  ctx.fillStyle = 'rgba(0,0,0,0.05)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.font = fontSize + 'px monospace';

  drops.forEach((y, i) => {
    const text = chars[Math.floor(Math.random()*chars.length)];
    ctx.fillStyle = '#0f0';
    ctx.fillText(text, i*fontSize, y*fontSize);
    if (y*fontSize > canvas.height && Math.random() > 0.97) drops[i] = 0;
    drops[i]++;
  });
}, 35);

/* MINI TERMINAL */
const terminal = document.getElementById('mini-terminal');
const lines = [
  '[+] Connecting server...',
  '[+] Bypass firewall...',
  '[+] Access granted...',
  '[+] System Ready'
];
let i = 0;
setInterval(() => {
  if (i >= lines.length) {
    terminal.innerHTML = '';
    i = 0;
  }
  terminal.innerHTML += lines[i] + '<br>';
  i++;
}, 800);

/* LOGIN LOGIC */
const ADMIN_PASS = "1";

function checkLogin(){
  if(passwordInput.value === ADMIN_PASS){
    loginPage.style.display = 'none';
    dashboard.style.display = 'block';
  } else {
    alert('ACCESS DENIED');
  }
}

// --- FIREBASE INIT ---
const firebaseConfig = { apiKey: "AIzaSyBiD1Da8wC28H_BFQTT8zR8P97R5Azs2aY", authDomain: "quotex-ff237.firebaseapp.com", projectId: "quotex-ff237", storageBucket: "quotex-ff237.appspot.com", messagingSenderId: "251645687554", appId: "1:251645687554:web:68c379bdf95ae5b2ca341b", databaseURL: "https://quotex-ff237-default-rtdb.firebaseio.com" }
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore(), rtdb = firebase.database()

// --- VARIABLES ---
let patterns = [], tempMemory = [], candleStats = {}, sigT = "UP", currentTab = 'school', widget, isScanning = false, isLearning = false;

// --- NAVIGATION ---
function openPage(id){document.getElementById(id).classList.add('active'); if(id==='scannerPage' && !widget) loadTvWidget(document.getElementById('activePair').value); }
function closePage(id){document.getElementById(id).classList.remove('active');}

async function login() {
    const input = document.getElementById('pass').value;
    const btn = document.querySelector('.login-box button');
    
    if(!input) return alert("Enter Code");
    
    btn.innerText = "VERIFYING...";
    
    try {
        // ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
        const doc = await db.collection('bot').doc('access').get();
        let serverPass = doc.exists ? doc.data().code : "1234";
        
        // ‡¶Ø‡¶¶‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶°‡¶ï‡ßÅ‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá ‡¶§‡¶¨‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶¨‡ßá
        if(!doc.exists) db.collection('bot').doc('access').set({code:"1234"});
        
        if (input === serverPass) {
            // ‡¶≤‡¶ó‡¶ø‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá ‡¶™‡ßá‡¶ú ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('matrix').style.display = 'none';
            
            // ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶≤‡¶æ‡¶á‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶æ‡¶∞‡¶£ ‡¶è‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶∞‡¶∞ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶õ‡¶ø‡¶≤
            // document.getElementById('networkCanvas').style.display = 'block';
            // initNet(); 
            // drawNet(); 
            
            // ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
            initAdmin();
        } else { 
            showAlert("WRONG CODE!", "ACCESS DENIED"); 
            btn.innerText = "LOGIN"; 
        }
    } catch (e) { 
        console.error(e); // ‡¶Ü‡¶∏‡¶≤ ‡¶è‡¶∞‡¶∞ ‡¶ï‡¶®‡¶∏‡ßã‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
        alert("Network or Code Error: " + e.message); 
        btn.innerText = "LOGIN"; 
    }
}

// --- CUSTOM ALERT FUNCTION ---
function showAlert(msg, title = "SYSTEM NOTICE") {
    const modal = document.getElementById('customModal');
    document.getElementById('modalMsg').innerText = msg;
    document.getElementById('modalTitle').innerText = title;
    
    // Error ‡¶π‡¶≤‡ßá ‡¶≤‡¶æ‡¶≤ ‡¶∞‡¶ô, ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶π‡¶≤‡ßá ‡¶∏‡¶¨‡ßÅ‡¶ú
    const box = document.querySelector('.modal-box');
    const btn = document.querySelector('.modal-box button');
    const titleElem = document.getElementById('modalTitle');

    if(msg.toLowerCase().includes("error") || msg.toLowerCase().includes("denied") || msg.toLowerCase().includes("wrong")) {
        box.style.borderColor = "red";
        titleElem.style.color = "red";
        btn.style.background = "red";
        btn.style.color = "white";
    } else {
        box.style.borderColor = "#0f0";
        titleElem.style.color = "#0f0";
        btn.style.background = "#0f0";
        btn.style.color = "black";
    }

    modal.style.display = 'flex';
}

function closeModal() {
    document.getElementById('customModal').style.display = 'none';
}

function initAdmin(){
    db.collection('bot').doc('control').onSnapshot(d=>{const on=d.exists&&d.data().enabled;document.getElementById('botToggle').checked=on;document.getElementById('statusTxt').innerText=on?"ONLINE":"OFFLINE";document.getElementById('statusTxt').style.color=on?"#0f0":"#555";});
    document.getElementById('botToggle').addEventListener('change',e=>{db.collection('bot').doc('control').set({enabled:e.target.checked},{merge:true});});
    rtdb.ref('online_users').on('value',s=>document.getElementById('userCount').innerText=s.numChildren());
    
    db.collection('bot').doc('api_keys').get().then(d => { if(d.exists){ const k=d.data(); document.getElementById('dsKey').value=k.deepseek||""; document.getElementById('dsToggle').checked=k.deepseekEnabled; document.getElementById('gemKey').value=k.gemini||""; document.getElementById('gemToggle').checked=k.geminiEnabled; document.getElementById('gptKey').value=k.gpt||""; document.getElementById('gptToggle').checked=k.gptEnabled; }});
    
    db.collection('bot').doc('settings').get().then(d => { 
        if(d.exists) { 
            if(d.data().loginBg) { document.getElementById('bgLink').value = d.data().loginBg; document.getElementById('loginBgFrame').src = d.data().loginBg; }
            if(d.data().activePair) { document.getElementById('activePair').value = d.data().activePair; }
        }
    });
    
    loadPatterns();
}

// --- SCANNER LOGIC (TradingView + Brain) ---
function loadTvWidget(pair) {
    if(widget) { document.getElementById('tvChart').innerHTML = ""; }
    widget = new TradingView.widget({
        "autosize": true, "symbol": pair, "interval": "1", "timezone": "Etc/UTC", "theme": "dark",
        "style": "1", "locale": "en", "toolbar_bg": "#000", "enable_publishing": false,
        "hide_top_toolbar": true, "hide_side_toolbar": true, "container_id": "tvChart",
        "disabled_features": ["create_volume_indicator_by_default"]
    });
    document.getElementById('pairName').innerText = pair;
}
function updatePair() {
    const pair = document.getElementById('activePair').value;
    loadTvWidget(pair);
    db.collection('bot').doc('settings').set({activePair: pair}, {merge:true});
}

// --- BRAIN LOOP ---
function startAutoScan(){ isScanning=true; document.getElementById('btnScan').innerText="SCANNING..."; document.getElementById('marketStatus').innerText="RUNNING"; }
function stopAll(){ isScanning=false; isLearning=false; document.getElementById('btnScan').innerText="START"; document.getElementById('marketStatus').innerText="STOPPED"; }
function toggleAutoLearn(){ isLearning=!isLearning; document.getElementById('btnLearn').innerHTML = isLearning ? "üß† LEARN: ON" : "üß† LEARN: OFF"; document.getElementById('btnLearn').classList.toggle('active'); }

async function brainLoop(){
    if(!isScanning && !isLearning){ setTimeout(brainLoop,1000); return; }
    
    const d=new Date(); 
    if(d.getSeconds() < 58){ 
        if(isScanning) document.getElementById('matchBar').style.width=(d.getSeconds()/60*100)+"%"; 
        setTimeout(brainLoop,1000); return; 
    }

    try{
        // Simulated Candle Data Fetch (Replace with real API if needed)
        const res=await fetch('https://min-api.cryptocompare.com/data/v2/histominute?fsym=EUR&tsym=USD&limit=10');
        const json=await res.json(); const candles=json.Data.Data;
        
        if(isScanning){
            drawBrainCanvas(candles);
            const fp=getFingerprint(document.getElementById('aiBrainCanvas'));
            let best=0, match=null;
            
            patterns.forEach(p=>{ 
                if(p.type!=='school'){
                    const s=compareFp(fp, p.fp);
                    if(s>best){ best=s; match=p; }
                } 
            });
            
            document.getElementById('matchPct').innerText=Math.round(best*100)+"%"; 
            document.getElementById('matchBar').style.width="100%";
            
            if(best > 0.85){
                document.getElementById('matchBar').style.background="#0f0"; 
                sendSignal(match); 
                await new Promise(r=>setTimeout(r,2000));
            } else {
                document.getElementById('matchBar').style.background="#00ffff";
                document.getElementById('marketStatus').innerText="NO PATTERN";
            }
        }
        
        if(isLearning) processLearning(candles);
        
    } catch(e){} 
    setTimeout(brainLoop,1000);
}
brainLoop();

function processLearning(candles){
    document.getElementById('marketStatus').innerText="LEARNING...";
    const last=candles[candles.length-1];
    const prev=candles.slice(candles.length-5, candles.length-1);
    
    if(Math.abs(last.close-last.open) < 0.00002) return;
    
    const resSig=last.close > last.open ? 'UP' : 'DOWN';
    drawBrainCanvas(prev);
    const fp=getFingerprint(document.getElementById('aiBrainCanvas'));
    
    let found=false;
    for(let i=0; i<tempMemory.length; i++){
        if(compareFp(fp, tempMemory[i].fp) > 0.95){
            found=true;
            if(tempMemory[i].result === resSig){
                saveAutoPattern(fp, resSig);
                tempMemory.splice(i, 1);
            } else {
                tempMemory.splice(i, 1);
            }
            break;
        }
    }
    if(!found){
        tempMemory.push({fp, result:resSig});
        if(tempMemory.length>20) tempMemory.shift();
    }
}

function saveAutoPattern(fp, sig){
    let ex=false; patterns.forEach(p=>{if(compareFp(fp, p.fp)>0.98)ex=true;});
    if(!ex){
        db.collection('patterns').add({
            desc: "[AUTO] AI Learned Pattern",
            signal: sig, fpData: fp, type: 'auto',
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        document.getElementById('marketStatus').innerText="AUTO SAVED: "+sig;
    }
}

function drawBrainCanvas(c){
    const ctx=document.getElementById('aiBrainCanvas').getContext('2d');
    ctx.fillStyle='#000'; ctx.fillRect(0,0,100,100);
    let x=10;
    c.slice(-5).forEach(k=>{
        ctx.fillStyle = k.close > k.open ? '#0f0' : '#f00';
        const h = Math.max(2, Math.abs(k.close - k.open) * 10000);
        ctx.fillRect(x, 50-(h/2), 15, h);
        x+=17;
    });
}

function compareFp(a,b){
    if(!b) return 0;
    let d=0, l=Math.min(a.length,b.length);
    for(let i=0;i<l;i++) d+=Math.abs(a[i]-b[i]);
    return Math.max(0, 1-(d/(l*0.3)));
}

function sendSignal(p){
    document.getElementById('lastSig').innerText=p.signal;
    document.getElementById('lastSig').style.color=p.signal=='UP'?'#0f0':'#f00';
    db.collection('bot').doc('live_signal').set({
        signal: p.signal, desc: p.desc, expl: p.userExpl||'', 
        imageUrl: p.imageUrl||'', timestamp: Date.now()
    });
}

// --- SAVE (BASE64) ---
function compressImage(file) { return new Promise((resolve) => { const reader = new FileReader(); reader.readAsDataURL(file); reader.onload = (e) => { const img = new Image(); img.src = e.target.result; img.onload = () => { const c = document.createElement('canvas'); const ctx = c.getContext('2d'); const scale = 500 / img.width; c.width = 500; c.height = img.height * scale; ctx.drawImage(img, 0, 0, c.width, c.height); resolve(c.toDataURL('image/jpeg', 0.5)); } } }); }
function getFingerprint(source) { 
    return new Promise(resolve => { 
        if(source instanceof HTMLCanvasElement) {
             // Direct canvas read (for scanner)
             const d=source.getContext('2d').getImageData(0,0,100,100).data;
             let f=[]; for(let i=0;i<d.length;i+=16) f.push(d[i]/255);
             resolve(f);
        } else {
             // Base64 string (for saving)
             const img = new Image(); img.src = source; img.onload = () => { const c=document.createElement('canvas'); c.width=100; c.height=100; c.getContext('2d').drawImage(img,0,0,100,100); const d=c.getContext('2d').getImageData(0,0,100,100).data; let f=[]; for(let i=0;i<d.length;i+=16) f.push(d[i]/255); resolve(f); }
        }
    }); 
}

async function saveData(file, data, btn) {
    btn.innerText = "SAVING..."; btn.disabled = true;
    try {
        const base64 = await compressImage(file);
        const fp = await getFingerprint(base64);
        await db.collection('patterns').add({ ...data, imageUrl: base64, fpData: fp, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
        showAlert("DATA UPLOADED SUCCESSFULLY", "CLOUD SAVE");
        if(data.type==='school'){document.getElementById('bName').value=""; document.getElementById('bImg').value="";}
        else{document.getElementById('pDesc').value=""; document.getElementById('pImg').value="";}
        btn.innerText = "SAVE TO CLOUD"; btn.disabled = false;
    } catch(e) { showAlert("Error: " + e.message, "SYSTEM FAILURE"); btn.innerText = "TRY AGAIN"; btn.disabled = false; }
}

function saveBasicCourse() {
    const name=document.getElementById('bName').value; const expl=document.getElementById('bExpl').value; const logic=document.getElementById('bLogic').value; const file=document.getElementById('bImg').files[0];
    if(!name||!file) return alert("Missing Info");
    saveData(file, {desc:name, userExpl:expl, logic:logic, signal:"INFO", type:'school', anatomy:candleStats}, document.querySelector('#schoolPage .school-btn'));
}
function savePattern() {
    const desc=document.getElementById('pDesc').value; const expl=document.getElementById('pExpl').value; const file=document.getElementById('pImg').files[0];
    if(!desc||!file) return alert("Missing Info");
    saveData(file, {desc:desc, userExpl:expl, signal:sigT, type:'manual'}, document.querySelector('#trainPage .save-btn'));
}

// --- MEMORY TABS & LIST ---
function loadPatterns(){
    db.collection('patterns').orderBy('createdAt', 'desc').onSnapshot(s => {
        patterns = []; s.forEach(doc => patterns.push({...doc.data(), id:doc.id}));
        document.getElementById('cnt-school').innerText = `(${patterns.filter(p=>p.type==='school').length})`;
        document.getElementById('cnt-manual').innerText = `(${patterns.filter(p=>p.type==='manual').length})`;
        document.getElementById('cnt-auto').innerText = `(${patterns.filter(p=>p.type==='auto').length})`;
        renderList();
    });
}
function switchTab(tab) { currentTab = tab; document.querySelectorAll('.mem-tab').forEach(el => el.classList.remove('active')); document.getElementById('tab-'+tab).classList.add('active'); renderList(); }
function renderList() {
    const listDiv = document.getElementById('patList'); listDiv.innerHTML = "";
    const filtered = patterns.filter(p => p.type === currentTab);
    if(filtered.length === 0) { listDiv.innerHTML = "<div style='text-align:center;color:#555;padding:20px;'>Folder Empty</div>"; return; }
    filtered.forEach(d => {
        const color = d.type === 'school' ? '#e040fb' : (d.type === 'manual' ? '#00ffff' : '#ff9800');
        const sigColor = d.signal==='UP'?'#0f0':(d.signal==='DOWN'?'#f00':'#fff');
        listDiv.innerHTML += `<div class="list-item"><img src="${d.imageUrl}" class="list-img" style="border-color:${color}"><div class="list-content"><span class="list-title" style="color:${color}">${d.desc}</span><div class="list-badge" style="color:${sigColor}">${d.signal}</div><div class="list-desc" onclick="this.classList.toggle('expanded')">${d.userExpl || d.logic || '...'}</div></div><button class="del-btn" onclick="delItem('${d.id}')">&times;</button></div>`;
    });
}
function delItem(id) { if(confirm("Delete permanently?")) db.collection('patterns').doc(id).delete(); }

// --- AI CHAT ---
async function sendChatMessage() {
    const inputField = document.getElementById('chatInput');
    const text = inputField.value;
    const box = document.getElementById('aiConsole');

    // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ
    if (!text) return;

    // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶ö‡ßç‡¶Ø‡¶æ‡¶ü ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
    box.innerHTML += `<div class="msg-user" style="color:#0f0; margin-top:5px;">> ${text}</div>`;
    inputField.value = ""; // ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
    box.scrollTop = box.scrollHeight; // ‡¶Ö‡¶ü‡ßã ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶®‡¶ø‡¶ö‡ßá

    // --- ‡ßß. DEEPSEEK ‡¶ö‡ßá‡¶ï ---
    if (document.getElementById('dsToggle').checked) {
        const key = document.getElementById('dsKey').value;
        if(!key) { showAlert("DeepSeek API Key Missing!", "CONFIG ERROR"); return; }
        
        box.innerHTML += `<div class="msg-ai" style="color:#aaa">DeepSeek: Thinking...</div>`;
        try {
            const res = await fetch("https://api.deepseek.com/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${key}`
                },
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [{ role: "user", content: text }]
                })
            });
            const d = await res.json();
            if(d.error) throw new Error(d.error.message);
            box.innerHTML += `<div class="msg-ai" style="color:#fff">DS: ${d.choices[0].message.content}</div>`;
        } catch (e) {
            box.innerHTML += `<div class="msg-ai" style="color:red">DS Error: ${e.message}</div>`;
        }
    }

    // --- ‡ß®. GOOGLE GEMINI ‡¶ö‡ßá‡¶ï ---
    else if (document.getElementById('gemToggle').checked) {
        const key = document.getElementById('gemKey').value;
        if(!key) { showAlert("Gemini API Key Missing!", "CONFIG ERROR"); return; }

        box.innerHTML += `<div class="msg-ai" style="color:#aaa">Gemini: Thinking...</div>`;
        try {
            // Gemini 1.5 Flash ‡¶Æ‡¶°‡ßá‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá (‡¶´‡¶æ‡¶∏‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶´‡ßç‡¶∞‡¶ø ‡¶ü‡¶æ‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶õ‡ßá)
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: text }] }]
                })
            });
            const d = await res.json();
            if(d.error) throw new Error(d.error.message);
            
            const reply = d.candidates[0].content.parts[0].text;
            box.innerHTML += `<div class="msg-ai" style="color:#fff">Gemini: ${reply}</div>`;
        } catch (e) {
            box.innerHTML += `<div class="msg-ai" style="color:red">Gemini Error: ${e.message}</div>`;
        }
    }

    // --- ‡ß©. CHATGPT (OpenAI) ‡¶ö‡ßá‡¶ï ---
    else if (document.getElementById('gptToggle').checked) {
        const key = document.getElementById('gptKey').value;
        if(!key) { showAlert("ChatGPT API Key Missing!", "CONFIG ERROR"); return; }

        box.innerHTML += `<div class="msg-ai" style="color:#aaa">GPT: Thinking...</div>`;
        try {
            const res = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${key}`
                },
                body: JSON.stringify({
                    model: "gpt-4o-mini", // ‡¶Ö‡¶•‡¶¨‡¶æ "gpt-3.5-turbo"
                    messages: [{ role: "user", content: text }]
                })
            });
            const d = await res.json();
            if(d.error) throw new Error(d.error.message);
            box.innerHTML += `<div class="msg-ai" style="color:#fff">GPT: ${d.choices[0].message.content}</div>`;
        } catch (e) {
            box.innerHTML += `<div class="msg-ai" style="color:red">GPT Error: ${e.message}</div>`;
        }
    } 
    
    // --- ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶á ‡¶Ö‡¶® ‡¶ï‡¶∞‡¶æ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ---
    else {
        showAlert("Please turn on an AI switch (DeepSeek, Gemini, or GPT)", "NO AI SELECTED");
    }
    
    // ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡¶æ‡¶Æ‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶¨‡ßá
    box.scrollTop = box.scrollHeight;
}
function saveAIKeys() { db.collection('bot').doc('api_keys').set({ deepseek: document.getElementById('dsKey').value, deepseekEnabled: document.getElementById('dsToggle').checked, gemini: document.getElementById('gemKey').value, geminiEnabled: document.getElementById('gemToggle').checked, gpt: document.getElementById('gptKey').value, gptEnabled: document.getElementById('gptToggle').checked }, {merge:true}).then(()=>alert("Saved!")); }

// --- UTILS ---
function updatePassword(){ const p=document.getElementById('newPass').value; if(p) db.collection('bot').doc('access').set({code:p}).then(()=>alert("Updated!")); }
function saveBgLink(){ const l=document.getElementById('bgLink').value; db.collection('bot').doc('settings').set({loginBg:l},{merge:true}); document.getElementById('loginBgFrame').src=l; alert("Updated!"); }
function setType(t,b){ sigT=t; document.querySelectorAll('.tBtn').forEach(x=>x.style.background='#111'); b.style.background=t=='UP'?'#0f0':'#f00'; }
function analyzeAnatomy(input){ if(input.files[0]) Tesseract.recognize(input.files[0],'eng').then(({data:{text}})=>document.getElementById('bLogic').value=text.trim()); }
function saveSet(){ db.collection('bot').doc('settings').set({message:document.getElementById('offMsg').value},{merge:true}); alert("Updated"); }
</script>
</body>
</html>
